<?php
session_start();
include "../../../database/db.php";

$message = "";

// Handle form submission
if ($_SERVER["REQUEST_METHOD"] === "POST") {

    // Sanitize input
    $name = mysqli_real_escape_string($conn, $_POST['name']);
    $age = intval($_POST['age']);
    $contact_number = mysqli_real_escape_string($conn, $_POST['contact_number']);
    $current_address = mysqli_real_escape_string($conn, $_POST['current_address']);

    // 1. Check if a customer with the same name already exists
    $check = $conn->query("SELECT id FROM customers WHERE name='$name'");
    if ($check->num_rows > 0) {
        $message = "A customer with this name already exists.";
    } else {
        // 2. Insert into customers table
        $query = "INSERT INTO customers (name, age, contact_number, current_address) 
                  VALUES ('$name', $age, '$contact_number', '$current_address')";

        if (mysqli_query($conn, $query)) {
            // Redirect back to dashboard if successful
            header("Location: customer_dashboard.php");
            exit();
        } else {
            $message = "Error: " . mysqli_error($conn);
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add New Customer</title>
    <link rel="stylesheet" href="../../../css/create.css">
</head>
<body>
<!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <img class="logo" src="../../../assets/logo.svg" alt="">
            <div class="logo-text">
                <p class="logo-bold">cozy beans</p>
                <p class="logo-cursive">caf√©</p>
            </div>
        </div>
        <div class="links">
            <a href="admin_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 16 18">
                    <path d="M0 18V6L8 0L16 6V18H10V11H6V18H0Z" />
                </svg>
                Home
            </a>
            <a href="../food/food_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
                    <path
                        d="M23.2636 30H25.5273C26.6727 30 27.6136 29.1136 27.75 27.9955L30 5.52273H23.1818V0H20.4955V5.52273H13.7182L14.1273 8.71364C16.4591 9.35455 18.6409 10.5136 19.95 11.7955C21.9136 13.7318 23.2636 15.7364 23.2636 19.0091V30ZM0 28.6364V27.2727H20.4955V28.6364C20.4955 29.3727 19.8818 30 19.0909 30H1.36364C0.613636 30 0 29.3727 0 28.6364ZM20.4955 19.0909C20.4955 8.18182 0 8.18182 0 19.0909H20.4955ZM0 21.8182H20.4545V24.5455H0V21.8182Z" />
                </svg>
                Food
            </a>
            <a href="../users/customer_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="37" height="30" viewBox="0 0 37 30">
                    <path
                        d="M11.4271 14.4444C13.3033 14.4444 15.1026 13.6835 16.4292 12.3291C17.7558 10.9747 18.5011 9.13767 18.5011 7.22222C18.5011 5.30677 17.7558 3.46977 16.4292 2.11534C15.1026 0.76091 13.3033 0 11.4271 0C9.55102 0 7.75173 0.76091 6.42511 2.11534C5.09849 3.46977 4.3532 5.30677 4.3532 7.22222C4.3532 9.13767 5.09849 10.9747 6.42511 12.3291C7.75173 13.6835 9.55102 14.4444 11.4271 14.4444ZM23.8055 25.8778C24.9591 26.36 26.4261 26.6667 28.2936 26.6667C37 26.6667 37 20 37 20C37 19.1163 36.6563 18.2688 36.0445 17.6438C35.4327 17.0187 34.6028 16.6673 33.7373 16.6667H23.664C24.5194 17.7244 25.0331 19.0778 25.0331 20.5556V21.3467C25.0284 21.5338 25.0161 21.7206 24.9961 21.9067C24.8479 23.2949 24.4425 24.6421 23.8055 25.8778ZM33.7373 8.88889C33.7373 10.3623 33.164 11.7754 32.1435 12.8173C31.123 13.8591 29.739 14.4444 28.2958 14.4444C26.8526 14.4444 25.4685 13.8591 24.4481 12.8173C23.4276 11.7754 22.8543 10.3623 22.8543 8.88889C22.8543 7.41546 23.4276 6.00239 24.4481 4.96052C25.4685 3.91865 26.8526 3.33333 28.2958 3.33333C29.739 3.33333 31.123 3.91865 32.1435 4.96052C33.164 6.00239 33.7373 7.41546 33.7373 8.88889ZM0 21.1111C0 19.9324 0.458639 18.8019 1.27502 17.9684C2.0914 17.1349 3.19866 16.6667 4.3532 16.6667H18.5011C19.6556 16.6667 20.7629 17.1349 21.5793 17.9684C22.3956 18.8019 22.8543 19.9324 22.8543 21.1111C22.8543 21.1111 22.8543 30 11.4271 30C0 30 0 21.1111 0 21.1111Z" />
                </svg>
                Customers
            </a>
            <a href="../orders/order_history_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="39" height="32" viewBox="0 0 39 32">
                    <path
                        d="M36.7305 27.6738C37.2178 27.6739 37.6729 27.8903 37.999 28.2539C38.3235 28.6158 38.497 29.0962 38.4971 29.5869C38.4971 30.0776 38.3234 30.5581 37.999 30.9199C37.6729 31.2836 37.2178 31.5 36.7305 31.5H18.9932C18.5058 31.5 18.0507 31.2836 17.7246 30.9199C17.4002 30.5581 17.2256 30.0777 17.2256 29.5869C17.2256 29.0961 17.4001 28.6158 17.7246 28.2539C18.0507 27.8902 18.5058 27.6738 18.9932 27.6738H36.7305ZM28.082 0.536133C28.3214 0.484845 28.5685 0.488253 28.8066 0.544922C29.0445 0.601606 29.2665 0.710393 29.46 0.861328C29.6533 1.01219 29.8144 1.20167 29.9355 1.41699C30.0566 1.63227 30.1363 1.87024 30.1719 2.11621C30.2074 2.36222 30.1978 2.61387 30.1445 2.85645C30.0922 3.09432 29.9971 3.32042 29.8643 3.52246L29.8652 3.52344L12.8525 30.623C12.7213 30.8328 12.5519 31.0153 12.3506 31.1562C12.1491 31.2972 11.921 31.3942 11.6797 31.4375C11.4382 31.4807 11.1907 31.4694 10.9541 31.4043C10.7176 31.3392 10.4985 31.2223 10.3096 31.0645L1.18652 23.4346C1.00193 23.2802 0.849102 23.0891 0.735352 22.875C0.621609 22.6608 0.547605 22.4256 0.516602 22.1836C0.454264 21.697 0.567011 21.1972 0.838867 20.793C1.11158 20.3877 1.5287 20.104 2.00879 20.0273C2.49074 19.9506 2.97396 20.0929 3.34863 20.4062L10.9854 26.792L26.9424 1.37207H26.9434C27.0676 1.16449 27.2294 0.982658 27.4219 0.838867C27.6185 0.691969 27.8428 0.587445 28.082 0.536133ZM36.7305 19.1963C37.2178 19.1963 37.6729 19.4127 37.999 19.7764C38.3234 20.1382 38.4971 20.6187 38.4971 21.1094C38.497 21.6001 38.3235 22.0806 37.999 22.4424C37.6729 22.806 37.2178 23.0224 36.7305 23.0225H24.0615C23.5742 23.0224 23.1191 22.806 22.793 22.4424C22.4685 22.0806 22.295 21.6001 22.2949 21.1094C22.2949 20.6187 22.4686 20.1382 22.793 19.7764C23.1191 19.4127 23.5742 19.1963 24.0615 19.1963H36.7305ZM36.7324 10.7188C37.2196 10.7188 37.6749 10.9344 38.001 11.2979C38.3254 11.6596 38.4999 12.1402 38.5 12.6309C38.5 13.1216 38.3254 13.602 38.001 13.9639C37.6748 14.3275 37.2198 14.5439 36.7324 14.5439H29.1299C28.6426 14.5439 28.1884 14.3275 27.8623 13.9639C27.5378 13.602 27.3633 13.1217 27.3633 12.6309C27.3634 12.1402 27.5379 11.6596 27.8623 11.2979C28.1884 10.9345 28.6428 10.7188 29.1299 10.7188H36.7324Z" />
                </svg>
                Finished Orders
            </a>
            <a href="../../login/logout.php" class="nav-link-logout">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 16 18">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M11 0C11.1313 -2.7674e-09 11.2614 0.0258659 11.3827 0.0761206C11.504 0.126375 11.6142 0.200035 11.7071 0.292893C11.8 0.385752 11.8736 0.495991 11.9239 0.617317C11.9741 0.738642 12 0.868678 12 1C12 1.13132 11.9741 1.26136 11.9239 1.38268C11.8736 1.50401 11.8 1.61425 11.7071 1.70711C11.6142 1.79997 11.504 1.87362 11.3827 1.92388C11.2614 1.97413 11.1313 2 11 2H2V15C2 15.2652 2.10536 15.5196 2.29289 15.7071C2.48043 15.8946 2.73478 16 3 16H11C11.2652 16 11.5196 16.1054 11.7071 16.2929C11.8946 16.4804 12 16.7348 12 17C12 17.2652 11.8946 17.5196 11.7071 17.7071C11.5196 17.8946 11.2652 18 11 18H3C2.20435 18 1.44129 17.6839 0.87868 17.1213C0.316071 16.5587 0 15.7956 0 15V1C0 0.734784 0.105357 0.48043 0.292893 0.292893C0.48043 0.105357 0.734784 0 1 0H11ZM12.707 5.293C12.5672 5.15325 12.3891 5.05806 12.1953 5.01946C12.0014 4.98087 11.8005 5.00058 11.6178 5.07613C11.4351 5.15168 11.279 5.27966 11.169 5.44392C11.0591 5.60817 11.0002 5.80133 11 5.999V7.999H5C4.73478 7.999 4.48043 8.10436 4.29289 8.29189C4.10536 8.47943 4 8.73378 4 8.999C4 9.26422 4.10536 9.51857 4.29289 9.70611C4.48043 9.89364 4.73478 9.999 5 9.999H11V11.999C11 12.1968 11.0587 12.39 11.1686 12.5545C11.2785 12.7189 11.4346 12.847 11.6173 12.9227C11.8 12.9983 12.0011 13.0182 12.195 12.9796C12.389 12.941 12.5671 12.8458 12.707 12.706L15.707 9.706C15.8945 9.51847 15.9998 9.26416 15.9998 8.999C15.9998 8.73384 15.8945 8.47953 15.707 8.292L12.707 5.293Z" />
                </svg>
                Logout
            </a>
        </div>
    </nav>


<div class="page-title"> 
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="70" height="70" viewBox="0 0 70 70" fill="none">
    <circle cx="35" cy="35" r="35" fill="#822E2E"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.423 26.7655C21.0705 26.7655 21.6915 26.5083 22.1493 26.0505C22.6072 25.5926 22.8644 24.9716 22.8644 24.3241C22.8644 23.6766 22.6072 23.0557 22.1493 22.5978C21.6915 22.14 21.0705 21.8828 20.423 21.8828C19.7755 21.8828 19.1545 22.14 18.6967 22.5978C18.2389 23.0557 17.9816 23.6766 17.9816 24.3241C17.9816 24.9716 18.2389 25.5926 18.6967 26.0505C19.1545 26.5083 19.7755 26.7655 20.423 26.7655ZM20.423 31.6483C22.3655 31.6483 24.2284 30.8766 25.602 29.5031C26.9755 28.1296 27.7472 26.2666 27.7472 24.3241C27.7472 22.3817 26.9755 20.5187 25.602 19.1452C24.2284 17.7716 22.3655 17 20.423 17C18.4805 17 16.6176 17.7716 15.2441 19.1452C13.8705 20.5187 13.0989 22.3817 13.0989 24.3241C13.0989 26.2666 13.8705 28.1296 15.2441 29.5031C16.6176 30.8766 18.4805 31.6483 20.423 31.6483Z" fill="#FFFBFB"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.5448 33.4793C19.5736 33.4793 18.6421 33.8651 17.9554 34.5519C17.2686 35.2387 16.8828 36.1702 16.8828 37.1414V40.8035C16.8828 41.451 16.6255 42.0719 16.1677 42.5298C15.7099 42.9876 15.0889 43.2448 14.4414 43.2448C13.7939 43.2448 13.1729 42.9876 12.7151 42.5298C12.2572 42.0719 12 41.451 12 40.8035V37.1414C12 34.8752 12.9003 32.7018 14.5027 31.0993C16.1052 29.4968 18.2786 28.5966 20.5448 28.5966C22.8111 28.5966 24.9845 29.4968 26.5869 31.0993C28.1894 32.7018 29.0897 34.8752 29.0897 37.1414V40.8035C29.0897 41.451 28.8325 42.0719 28.3746 42.5298C27.9168 42.9876 27.2958 43.2448 26.6483 43.2448C26.0008 43.2448 25.3798 42.9876 24.922 42.5298C24.4641 42.0719 24.2069 41.451 24.2069 40.8035V37.1414C24.2069 36.1702 23.8211 35.2387 23.1343 34.5519C22.4475 33.8651 21.5161 33.4793 20.5448 33.4793ZM49.7193 26.7655C49.0718 26.7655 48.4509 26.5083 47.993 26.0505C47.5352 25.5926 47.278 24.9716 47.278 24.3241C47.278 23.6766 47.5352 23.0557 47.993 22.5978C48.4509 22.14 49.0718 21.8828 49.7193 21.8828C50.3668 21.8828 50.9878 22.14 51.4457 22.5978C51.9035 23.0557 52.1607 23.6766 52.1607 24.3241C52.1607 24.9716 51.9035 25.5926 51.4457 26.0505C50.9878 26.5083 50.3668 26.7655 49.7193 26.7655ZM49.7193 31.6483C47.7769 31.6483 45.9139 30.8766 44.5404 29.5031C43.1668 28.1296 42.3952 26.2666 42.3952 24.3241C42.3952 22.3817 43.1668 20.5187 44.5404 19.1452C45.9139 17.7716 47.7769 17 49.7193 17C51.6618 17 53.5247 17.7716 54.8983 19.1452C56.2718 20.5187 57.0435 22.3817 57.0435 24.3241C57.0435 26.2666 56.2718 28.1296 54.8983 29.5031C53.5247 30.8766 51.6618 31.6483 49.7193 31.6483Z" fill="#FFFBFB"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M49.5973 33.4792C50.5686 33.4792 51.5 33.865 52.1868 34.5518C52.8736 35.2386 53.2594 36.17 53.2594 37.1413V40.8033C53.2594 41.4508 53.5166 42.0718 53.9745 42.5297C54.4323 42.9875 55.0533 43.2447 55.7008 43.2447C56.3483 43.2447 56.9692 42.9875 57.4271 42.5297C57.8849 42.0718 58.1422 41.4508 58.1422 40.8033V37.1413C58.1422 34.875 57.2419 32.7016 55.6394 31.0992C54.037 29.4967 51.8636 28.5964 49.5973 28.5964C47.3311 28.5964 45.1577 29.4967 43.5552 31.0992C41.9527 32.7016 41.0525 34.875 41.0525 37.1413V40.8033C41.0525 41.4508 41.3097 42.0718 41.7676 42.5297C42.2254 42.9875 42.8464 43.2447 43.4939 43.2447C44.1414 43.2447 44.7623 42.9875 45.2202 42.5297C45.678 42.0718 45.9353 41.4508 45.9353 40.8033V37.1413C45.9353 36.17 46.3211 35.2386 47.0078 34.5518C47.6946 33.865 48.6261 33.4792 49.5973 33.4792Z" fill="#FFFBFB"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M35.1932 40.1928C33.5745 40.1928 32.0221 40.8359 30.8775 41.9805C29.7328 43.1251 29.0898 44.6775 29.0898 46.2963V49.9583C29.0898 50.6058 28.8326 51.2268 28.3747 51.6847C27.9169 52.1425 27.2959 52.3997 26.6484 52.3997C26.0009 52.3997 25.3799 52.1425 24.9221 51.6847C24.4642 51.2268 24.207 50.6058 24.207 49.9583V46.2963C24.207 43.3825 25.3645 40.5882 27.4248 38.5278C29.4851 36.4675 32.2795 35.3101 35.1932 35.3101C38.107 35.3101 40.9014 36.4675 42.9617 38.5278C45.022 40.5882 46.1795 43.3825 46.1795 46.2963V49.9583C46.1795 50.6058 45.9222 51.2268 45.4644 51.6847C45.0065 52.1425 44.3856 52.3997 43.7381 52.3997C43.0906 52.3997 42.4696 52.1425 42.0118 51.6847C41.5539 51.2268 41.2967 50.6058 41.2967 49.9583V46.2963C41.2967 44.6775 40.6537 43.1251 39.509 41.9805C38.3644 40.8359 36.812 40.1928 35.1932 40.1928Z" fill="#FFFBFB"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M35.071 33.4791C35.7185 33.4791 36.3394 33.2219 36.7973 32.7641C37.2551 32.3062 37.5123 31.6853 37.5123 31.0378C37.5123 30.3903 37.2551 29.7693 36.7973 29.3114C36.3394 28.8536 35.7185 28.5964 35.071 28.5964C34.4235 28.5964 33.8025 28.8536 33.3447 29.3114C32.8868 29.7693 32.6296 30.3903 32.6296 31.0378C32.6296 31.6853 32.8868 32.3062 33.3447 32.7641C33.8025 33.2219 34.4235 33.4791 35.071 33.4791ZM35.071 38.3619C37.0135 38.3619 38.8764 37.5903 40.2499 36.2167C41.6235 34.8432 42.3951 32.9802 42.3951 31.0378C42.3951 29.0953 41.6235 27.2324 40.2499 25.8588C38.8764 24.4853 37.0135 23.7136 35.071 23.7136C33.1285 23.7136 31.2656 24.4853 29.892 25.8588C28.5185 27.2324 27.7468 29.0953 27.7468 31.0378C27.7468 32.9802 28.5185 34.8432 29.892 36.2167C31.2656 37.5903 33.1285 38.3619 35.071 38.3619Z" fill="#FFFBFB"/>
    </svg>
    <div class="title">
        <h2>Add New Customer</h2> 
    </div>
    
</div>
<div class="main-wrapper">
    <div class="form-container">
        <p class="error-message"><?php echo $message; ?></p>

        <form method="POST">
            <label>Name:</label>
            <input type="text" name="name" required>

            <label>Age:</label>
            <input type="number" name="age" required>

            <label>Contact Number:</label>
            <input type="text" name="contact_number" required>

            <label>Current Address:</label>
            <input type="text" name="current_address" required>

            <button type="submit">Add Customer</button>
        </form>

        <a href="customer_dashboard.php" class="back-link">Back to Dashboard</a>
    </div>
</div>


</body>
</html>
