<?php
include '../../../database/db.php'; // Adjust path if needed

$error = ''; // to store error messages

// If the "Submit" button was clicked
if (isset($_POST['submit'])) {

    // Get input values (using real_escape_string to allow # and ')
    $name = mysqli_real_escape_string($conn, $_POST['name']);
    $description = mysqli_real_escape_string($conn, $_POST['description']);
    $price = floatval($_POST['price']);

    // Check if a food item with the same name already exists
    $check = $conn->query("SELECT id FROM food_items WHERE name='$name'");
    if ($check->num_rows > 0) {
        $error = "A food item with this name already exists.";
    } else {
        // Insert into food_items table
        $sql = "INSERT INTO food_items (name, description, price) VALUES ('$name', '$description', '$price')";
        
        // Redirect back to food_dashboard once finished
        if ($conn->query($sql)) {
            header("Location: food_dashboard.php"); 
            exit();
        } else {
            $error = "Error: " . $conn->error;
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Food Item</title>
    <link rel="stylesheet" href="../../../css/create.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <img class="logo" src="../../../assets/logo.svg" alt="">
            <div class="logo-text">
                <p class="logo-bold">cozy beans</p>
                <p class="logo-cursive">caf√©</p>
            </div>
        </div>
        <div class="links">
            <a href="admin_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 16 18">
                    <path d="M0 18V6L8 0L16 6V18H10V11H6V18H0Z" />
                </svg>
                Home
            </a>
            <a href="../food/food_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
                    <path
                        d="M23.2636 30H25.5273C26.6727 30 27.6136 29.1136 27.75 27.9955L30 5.52273H23.1818V0H20.4955V5.52273H13.7182L14.1273 8.71364C16.4591 9.35455 18.6409 10.5136 19.95 11.7955C21.9136 13.7318 23.2636 15.7364 23.2636 19.0091V30ZM0 28.6364V27.2727H20.4955V28.6364C20.4955 29.3727 19.8818 30 19.0909 30H1.36364C0.613636 30 0 29.3727 0 28.6364ZM20.4955 19.0909C20.4955 8.18182 0 8.18182 0 19.0909H20.4955ZM0 21.8182H20.4545V24.5455H0V21.8182Z" />
                </svg>
                Food
            </a>
            <a href="../users/customer_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="37" height="30" viewBox="0 0 37 30">
                    <path
                        d="M11.4271 14.4444C13.3033 14.4444 15.1026 13.6835 16.4292 12.3291C17.7558 10.9747 18.5011 9.13767 18.5011 7.22222C18.5011 5.30677 17.7558 3.46977 16.4292 2.11534C15.1026 0.76091 13.3033 0 11.4271 0C9.55102 0 7.75173 0.76091 6.42511 2.11534C5.09849 3.46977 4.3532 5.30677 4.3532 7.22222C4.3532 9.13767 5.09849 10.9747 6.42511 12.3291C7.75173 13.6835 9.55102 14.4444 11.4271 14.4444ZM23.8055 25.8778C24.9591 26.36 26.4261 26.6667 28.2936 26.6667C37 26.6667 37 20 37 20C37 19.1163 36.6563 18.2688 36.0445 17.6438C35.4327 17.0187 34.6028 16.6673 33.7373 16.6667H23.664C24.5194 17.7244 25.0331 19.0778 25.0331 20.5556V21.3467C25.0284 21.5338 25.0161 21.7206 24.9961 21.9067C24.8479 23.2949 24.4425 24.6421 23.8055 25.8778ZM33.7373 8.88889C33.7373 10.3623 33.164 11.7754 32.1435 12.8173C31.123 13.8591 29.739 14.4444 28.2958 14.4444C26.8526 14.4444 25.4685 13.8591 24.4481 12.8173C23.4276 11.7754 22.8543 10.3623 22.8543 8.88889C22.8543 7.41546 23.4276 6.00239 24.4481 4.96052C25.4685 3.91865 26.8526 3.33333 28.2958 3.33333C29.739 3.33333 31.123 3.91865 32.1435 4.96052C33.164 6.00239 33.7373 7.41546 33.7373 8.88889ZM0 21.1111C0 19.9324 0.458639 18.8019 1.27502 17.9684C2.0914 17.1349 3.19866 16.6667 4.3532 16.6667H18.5011C19.6556 16.6667 20.7629 17.1349 21.5793 17.9684C22.3956 18.8019 22.8543 19.9324 22.8543 21.1111C22.8543 21.1111 22.8543 30 11.4271 30C0 30 0 21.1111 0 21.1111Z" />
                </svg>
                Customers
            </a>
            <a href="../orders/order_history_dashboard.php" class="nav-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="39" height="32" viewBox="0 0 39 32">
                    <path
                        d="M36.7305 27.6738C37.2178 27.6739 37.6729 27.8903 37.999 28.2539C38.3235 28.6158 38.497 29.0962 38.4971 29.5869C38.4971 30.0776 38.3234 30.5581 37.999 30.9199C37.6729 31.2836 37.2178 31.5 36.7305 31.5H18.9932C18.5058 31.5 18.0507 31.2836 17.7246 30.9199C17.4002 30.5581 17.2256 30.0777 17.2256 29.5869C17.2256 29.0961 17.4001 28.6158 17.7246 28.2539C18.0507 27.8902 18.5058 27.6738 18.9932 27.6738H36.7305ZM28.082 0.536133C28.3214 0.484845 28.5685 0.488253 28.8066 0.544922C29.0445 0.601606 29.2665 0.710393 29.46 0.861328C29.6533 1.01219 29.8144 1.20167 29.9355 1.41699C30.0566 1.63227 30.1363 1.87024 30.1719 2.11621C30.2074 2.36222 30.1978 2.61387 30.1445 2.85645C30.0922 3.09432 29.9971 3.32042 29.8643 3.52246L29.8652 3.52344L12.8525 30.623C12.7213 30.8328 12.5519 31.0153 12.3506 31.1562C12.1491 31.2972 11.921 31.3942 11.6797 31.4375C11.4382 31.4807 11.1907 31.4694 10.9541 31.4043C10.7176 31.3392 10.4985 31.2223 10.3096 31.0645L1.18652 23.4346C1.00193 23.2802 0.849102 23.0891 0.735352 22.875C0.621609 22.6608 0.547605 22.4256 0.516602 22.1836C0.454264 21.697 0.567011 21.1972 0.838867 20.793C1.11158 20.3877 1.5287 20.104 2.00879 20.0273C2.49074 19.9506 2.97396 20.0929 3.34863 20.4062L10.9854 26.792L26.9424 1.37207H26.9434C27.0676 1.16449 27.2294 0.982658 27.4219 0.838867C27.6185 0.691969 27.8428 0.587445 28.082 0.536133ZM36.7305 19.1963C37.2178 19.1963 37.6729 19.4127 37.999 19.7764C38.3234 20.1382 38.4971 20.6187 38.4971 21.1094C38.497 21.6001 38.3235 22.0806 37.999 22.4424C37.6729 22.806 37.2178 23.0224 36.7305 23.0225H24.0615C23.5742 23.0224 23.1191 22.806 22.793 22.4424C22.4685 22.0806 22.295 21.6001 22.2949 21.1094C22.2949 20.6187 22.4686 20.1382 22.793 19.7764C23.1191 19.4127 23.5742 19.1963 24.0615 19.1963H36.7305ZM36.7324 10.7188C37.2196 10.7188 37.6749 10.9344 38.001 11.2979C38.3254 11.6596 38.4999 12.1402 38.5 12.6309C38.5 13.1216 38.3254 13.602 38.001 13.9639C37.6748 14.3275 37.2198 14.5439 36.7324 14.5439H29.1299C28.6426 14.5439 28.1884 14.3275 27.8623 13.9639C27.5378 13.602 27.3633 13.1217 27.3633 12.6309C27.3634 12.1402 27.5379 11.6596 27.8623 11.2979C28.1884 10.9345 28.6428 10.7188 29.1299 10.7188H36.7324Z" />
                </svg>
                Finished Orders
            </a>
            <a href="../../login/logout.php" class="nav-link-logout">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 16 18">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M11 0C11.1313 -2.7674e-09 11.2614 0.0258659 11.3827 0.0761206C11.504 0.126375 11.6142 0.200035 11.7071 0.292893C11.8 0.385752 11.8736 0.495991 11.9239 0.617317C11.9741 0.738642 12 0.868678 12 1C12 1.13132 11.9741 1.26136 11.9239 1.38268C11.8736 1.50401 11.8 1.61425 11.7071 1.70711C11.6142 1.79997 11.504 1.87362 11.3827 1.92388C11.2614 1.97413 11.1313 2 11 2H2V15C2 15.2652 2.10536 15.5196 2.29289 15.7071C2.48043 15.8946 2.73478 16 3 16H11C11.2652 16 11.5196 16.1054 11.7071 16.2929C11.8946 16.4804 12 16.7348 12 17C12 17.2652 11.8946 17.5196 11.7071 17.7071C11.5196 17.8946 11.2652 18 11 18H3C2.20435 18 1.44129 17.6839 0.87868 17.1213C0.316071 16.5587 0 15.7956 0 15V1C0 0.734784 0.105357 0.48043 0.292893 0.292893C0.48043 0.105357 0.734784 0 1 0H11ZM12.707 5.293C12.5672 5.15325 12.3891 5.05806 12.1953 5.01946C12.0014 4.98087 11.8005 5.00058 11.6178 5.07613C11.4351 5.15168 11.279 5.27966 11.169 5.44392C11.0591 5.60817 11.0002 5.80133 11 5.999V7.999H5C4.73478 7.999 4.48043 8.10436 4.29289 8.29189C4.10536 8.47943 4 8.73378 4 8.999C4 9.26422 4.10536 9.51857 4.29289 9.70611C4.48043 9.89364 4.73478 9.999 5 9.999H11V11.999C11 12.1968 11.0587 12.39 11.1686 12.5545C11.2785 12.7189 11.4346 12.847 11.6173 12.9227C11.8 12.9983 12.0011 13.0182 12.195 12.9796C12.389 12.941 12.5671 12.8458 12.707 12.706L15.707 9.706C15.8945 9.51847 15.9998 9.26416 15.9998 8.999C15.9998 8.73384 15.8945 8.47953 15.707 8.292L12.707 5.293Z" />
                </svg>
                Logout
            </a>
        </div>
    </nav>
    <!-- MAIN WRAPPER -->
    <div class="main-wrapper">

        <!-- PAGE HEADER WITH ICON -->
        <div class="page-title">
            <svg xmlns="http://www.w3.org/2000/svg" class = "icon" width="70" height="70" viewBox="0 0 70 70" fill="none">
            <circle cx="35" cy="35" r="35" fill="#822E2E"/>
            <path d="M44.3008 48.9167H46.86C48.155 48.9167 49.2188 47.9146 49.3729 46.6504L51.9167 21.2438H44.2083V15H41.1713V21.2438H33.5092L33.9717 24.8513C36.6079 25.5758 39.0746 26.8863 40.5546 28.3354C42.7746 30.5246 44.3008 32.7908 44.3008 36.4908V48.9167ZM18 47.375V45.8333H41.1713V47.375C41.1713 48.2075 40.4775 48.9167 39.5833 48.9167H19.5417C18.6938 48.9167 18 48.2075 18 47.375ZM41.1713 36.5833C41.1713 24.25 18 24.25 18 36.5833H41.1713ZM18 39.6667H41.125V42.75H18V39.6667Z" fill="white"/>
            </svg>
            <div class="title"> <h2>Add New Food Item</h2></div>
        </div>

        <!-- ERROR MESSAGE -->
        <?php if (!empty($error)) : ?>
            <p class="error-message"><?= $error ?></p>
        <?php endif; ?>

        <!-- FORM BOX -->
        <div class="form-container">

            <form method="POST">

                <!-- Name -->
                <label for="name">Food Name:</label>
                <input type="text" name="name" id="name" required>

                <!-- Price -->
                <label for="price">Price:</label>
                <input type="number" name="price" id="price" step="0.01" required>

                <!-- Description -->
                <label for="description">Description:</label>
                <textarea name="description" id="description" style="
                    width:100%;
                    height:100px;
                    padding:10px;
                    border:1px solid #ddd;
                    border-radius:8px;
                    font-size:16px;
                    resize:none;
                    margin-bottom:15px;
                "></textarea>

                <!-- Submit Button -->
                <button type="submit" name="submit">Save</button>
                <a href="food_dashboard.php" class="back-link">Back to Food Dashboard</a>

            </form>

        </div>

        <!-- BACK LINK -->
       

    </div>

</body>
</html>
